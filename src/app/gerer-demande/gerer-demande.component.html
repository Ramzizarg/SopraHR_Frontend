<div class="gerer-demande-page">
  <!-- Header -->
  <header id="header" class="header sticky-top">
    <div class="container-fluid container-lg">
      <div class="d-flex align-items-center justify-content-between">
        <!-- Logo -->
        <a href="/home" class="logo d-flex align-items-center">
          <div class="logo-container" style="max-width: 650px; height: auto;">
            <img src="../../assets/img/sopra_hr.png" 
                alt="Sopra HR Software" 
                loading="eager"
                class="sopra-logo img-fluid"
                style="max-height: 140px; object-fit: contain;">
          </div>
        </a>
        
        <!-- Main Navigation -->
        <div class="main-nav d-none d-lg-flex">
          <div class="nav-links-container d-flex align-items-center" style="gap: 0.5rem;">
            <a href="/home" class="nav-link"><i class="bi bi-house-door me-1"></i>Page d'accueil</a>
            <a href="/teletravail" class="nav-link"><i class="bi bi-laptop me-1"></i>Télétravail</a>
            <a href="/reservation" class="nav-link"><i class="bi bi-calendar-check me-1"></i>Réservations</a>
            <a href="/planning" class="nav-link"><i class="bi bi-calendar-week me-1"></i>Planning</a>
            <a href="/gestion-demandes" class="nav-link active"><i class="bi bi-gear me-1"></i>Gérer demande</a>
          </div>
        </div>
        
        <!-- User Controls -->
        <div class="user-controls d-flex align-items-center">
          <a href="javascript:void(0)" class="contact-icon ms-2" (click)="openContactModal()">
            <i class="bi bi-envelope-fill"></i>
          </a>
          <a href="/notifications" class="notification-icon ms-2">
            <i class="bi bi-bell-fill"></i>
          </a>
          <app-profile-header></app-profile-header>
          
          <!-- Mobile menu toggle button -->
          <a href="javascript:void(0)" class="d-lg-none ms-3">
            <i #mobileNavToggle class="mobile-nav-toggle bi" style="color: #ffffff !important;"
               [class.bi-list]="!isMobileMenuOpen" 
               [class.bi-x-lg]="isMobileMenuOpen"
               (click)="toggleMobileMenu($event)"></i>
          </a>
        </div>
      </div>
    </div>
    
    <!-- Mobile Navigation Sidebar -->
    <div class="mobile-nav-overlay d-lg-none" [class.active]="isMobileMenuOpen" (click)="toggleMobileMenu($event)"></div>
    <aside #navmenu class="sidebar-nav d-lg-none" [class.active]="isMobileMenuOpen">
      <div class="sidebar-header">
        <img src="../../assets/img/Sopra_Steria_logo.svg.png" alt="Sopra HR Software" class="sidebar-logo">
      </div>

      <nav class="sidebar-menu">
        <a href="/home" class="nav-item">
          <i class="bi bi-house-door"></i>
          <span>Page d'accueil</span>
        </a>
        <a href="/teletravail" class="nav-item">
          <i class="bi bi-laptop"></i>
          <span>Télétravail</span>
        </a>
        <a href="/reservation" class="nav-item">
          <i class="bi bi-calendar-check"></i>
          <span>Réservations</span>
        </a>
        <a href="/planning" class="nav-item">
          <i class="bi bi-calendar-week"></i>
          <span>Planning</span>
        </a>
        <a href="/gestion-demandes" class="nav-item active">
          <i class="bi bi-gear"></i>
          <span>Gérer demande</span>
        </a>
        <div class="sidebar-divider"></div>
      </nav>
    </aside>
  </header>

  <!-- Main Content -->
  <main class="main">
    <section class="demandes-section pt-4">
      <div class="container" data-aos="fade-up" data-aos-duration="600">
        <!-- Search and Filter Section -->
        <div class="row mb-4">
          <div class="col-12">
            <div class="search-filter-container d-flex flex-column flex-md-row align-items-md-center justify-content-md-between gap-3" data-aos="fade-up" data-aos-delay="200">
              <div *ngIf="isManager || isTeamLeader" class="team-display" data-aos="fade-right" data-aos-delay="150">
                <i class="fas fa-users-cog me-2"></i>
                <span>Team: {{ currentTeamName }}</span>
              </div>
              <div class="search-box flex-grow-1" data-aos="fade-right" data-aos-delay="200">
                <i class="fas fa-search search-icon"></i>
                <input type="text" 
                       class="form-control search-input" 
                       placeholder="Rechercher un employé..." 
                       [(ngModel)]="searchTerm"
                       (input)="filterRequests()"
                       autocomplete="off">
                <i *ngIf="searchTerm" class="fas fa-times clear-search-icon" (click)="searchTerm = ''; filterRequests()"></i>
              </div>
              <div class="btn-group filter-buttons" data-aos="fade-left" data-aos-delay="300">
                <button class="btn btn-outline-primary" 
                        [class.active]="selectedType === 'all'" 
                        (click)="selectedType = 'all'; filterRequests()">
                  <i class="fas fa-list"></i> Tous
                </button>
                <button class="btn btn-outline-secondary" 
                        [class.active]="selectedType === 'Régulière'" 
                        (click)="selectedType = 'Régulière'; filterRequests()">
                  <i class="fas fa-calendar-day"></i> Régulière
                </button>
                <button class="btn btn-outline-danger" 
                        [class.active]="selectedType === 'Exceptionnelle'" 
                        (click)="selectedType = 'Exceptionnelle'; filterRequests()">
                  <i class="fas fa-calendar-week"></i> Exceptionnelle
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Error Message -->
        <div class="error-message" *ngIf="error" data-aos="fade-up" data-aos-delay="100">
          <i class="fas fa-exclamation-circle"></i>
          {{ error }}
        </div>

        <!-- Bulk Actions -->
        <div class="bulk-actions" *ngIf="hasSelectedRequests()" data-aos="fade-up" data-aos-delay="200">
          <div class="d-flex justify-content-end">
            <div class="btn-group">
              <button class="btn btn-success" 
                      (click)="approveSelected()">
                <i class="fas fa-check"></i> Approuver sélection
              </button>
              <button class="btn btn-danger" 
                      (click)="rejectSelected()">
                <i class="fas fa-times"></i> Refuser sélection
              </button>
            </div>
          </div>
        </div>

        <!-- Table Section -->
        <div class="table-responsive" data-aos="fade-up" data-aos-delay="300">
          <table class="table">
            <thead>
              <tr>
                <th style="width: 40px;">
                  <input type="checkbox" 
                         class="form-check-input" 
                         [(ngModel)]="selectAll" 
                         (change)="toggleSelectAll()">
                </th>
                <th>Employé</th>
                <th>Date</th>
                <th>Type</th>
                <th>Statut</th>
                <th>Raison</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let request of filteredRequests; let i = index" 
                  [attr.data-aos]="'fade-up'"
                  [attr.data-aos-delay]="100 * i">
                <td>
                  <input type="checkbox" 
                         class="form-check-input" 
                         [(ngModel)]="request.selected" 
                         (change)="updateSelectAllState()">
                </td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="avatar-container me-2">
                      <img *ngIf="request.profilePhotoUrl" 
                           [src]="request.profilePhotoUrl" 
                           class="avatar-image" 
                           alt="Profile" 
                           (error)="handleImageError($event)"
                           [attr.crossorigin]="'use-credentials'"
                           loading="lazy">
                      <div *ngIf="!request.profilePhotoUrl" 
                           class="avatar-circle" 
                           [ngClass]="getTeamColorClass(request.team)">
                        {{ getInitials(request.employeeName || request.userName) }}
                      </div>
                    </div>
                    <div class="employee-info">
                      <span class="employee-name">{{ request.employeeName || request.userName }}</span>
                      <span class="employee-role" [ngClass]="getRoleClass(request.role)">{{ getRoleLabel(request.role) }}</span>
                    </div>
                  </div>
                </td>
                <td>{{ request.teletravailDate | date:'dd/MM/yyyy' }}</td>
                <td>
                  <span class="badge" 
                        [ngClass]="request.travailType === 'Régulière' ? 'bg-secondary' : 'bg-danger'">
                    {{ request.travailType }}
                  </span>
                </td>
                <td>
                  <span class="badge bg-warning">En attente</span>
                </td>
                <td>{{ request.reason || '...' }}</td>
                <td>
                  <div class="btn-group">
                    <button class="btn btn-sm btn-success" 
                            (click)="approveRequest(request)">
                      <i class="fas fa-check"></i>
                    </button>
                    <button class="btn btn-sm btn-danger" 
                            (click)="rejectRequest(request)">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td colspan="7">
                  <div class="table-footer">
                    <div class="footer-left">
                      <span class="total-count">Total: {{ allFilteredRequests.length }} demandes</span>
                    </div>
                    <div class="footer-right">
                      <div class="pagination-info">
                        <span>Page {{ currentPage }} sur {{ totalPages }}</span>
                      </div>
                      <div class="pagination-controls">
                        <button class="btn-page" [disabled]="currentPage === 1" (click)="previousPage()">
                          <i class="bi bi-chevron-left"></i>
                        </button>
                        <button class="btn-page" [disabled]="currentPage === totalPages" (click)="nextPage()">
                          <i class="bi bi-chevron-right"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </td>
              </tr>
            </tfoot>
          </table>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="filteredRequests.length === 0" data-aos="fade-up" data-aos-delay="200">
          <i class="fas fa-inbox"></i>
          <h3>Aucune demande en attente</h3>
          <p>Il n'y a actuellement aucune demande de télétravail en attente de validation.</p>
        </div>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer id="footer" class="footer dark-background">
    <div class="container footer-top">
      <div class="row gy-4">
        <div class="col-lg-4 col-md-6 footer-about">
          <a href="/home" class="logo d-flex align-items-center">
            <span class="sitename" style="margin-left: 25px;">Sopra HR</span>
          </a>
          <div class="social-links d-flex mt-4">
            <a href="https://x.com/sopraHR" class="twitter"><i class="bi bi-twitter-x"></i></a>
            <a href="https://www.facebook.com/SopraHR/?ref=br_rs" class="facebook"><i class="bi bi-facebook"></i></a>
            <a href="https://www.instagram.com/soprahr/" class="instagram"><i class="bi bi-instagram"></i></a>
            <a href="https://www.linkedin.com/company/soprahr/" class="linkedin"><i class="bi bi-linkedin"></i></a>
          </div>
        </div>
        <div class="col-lg-4 col-md-6 footer-links text-center ps-lg-5">
          <h4>Useful Links</h4>
          <ul>
            <li><a href="/home">Page d'accueil</a></li>
            <li><a href="/teletravail">Télétravail</a></li>
            <li><a href="/reservation">Réservations de Postes</a></li>
            <li><a href="/planning">Planning</a></li>
            <li><a href="javascript:void(0)" (click)="openContactModal()">Contact Us</a></li>
          </ul>
        </div>
        <div class="col-lg-4 col-md-6 footer-logo text-end ps-lg-5">
          <div class="logo-container">
            <img src="../../assets/img/Sopra_preview.png" alt="Company Logo" loading="lazy" class="footer-company-logo">
            <p class="copyright-text">© 2025 <span>Copyright</span> <strong class="px-1 sitename">Sopra HR</strong> <span>All Rights Reserved</span></p>
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center">
    <i class="bi bi-arrow-up-short"></i>
  </a>

  <!-- Contact Modal -->
  <div class="contact-modal" [class.active]="isContactModalOpen">
    <div class="contact-modal-overlay" (click)="closeContactModal()"></div>
    <div class="contact-modal-content">
      <div class="contact-modal-header">
        <h4>Contactez l'équipe support</h4>
        <button class="close-button" (click)="closeContactModal()">
          <i class="bi bi-x-lg"></i>
        </button>
      </div>
      <div class="contact-modal-body">
        <div class="contact-info">
          <div class="contact-item">
            <i class="bi bi-envelope-fill"></i>
            <span>support&#64;sopraHR.com</span>
          </div>
          <div class="contact-item">
            <i class="bi bi-telephone-fill"></i>
            <span>+33 (0)1 57 00 09 80</span>
          </div>
          <div class="contact-item">
            <i class="bi bi-geo-alt-fill"></i>
            <span>Tour Manhattan, 5/6 Place de l'Iris, 92095 Paris La Défense</span>
          </div>
        </div>
        <div class="contact-form">
          <h5>Formulaire de contact interne</h5>
          
          <div class="form-group">
            <label for="priority">Priorité</label>
            <select id="priority" class="form-control form-select">
              <option value="normal">🟢 Normal</option>
              <option value="high">🟠 Élevée</option>
              <option value="urgent">🔴 Urgente</option>
            </select>
          </div>
          
          <div class="form-group">
            <label for="subject" class="required">Sujet</label>
            <input type="text" id="subject" class="form-control" placeholder="Titre de votre demande">
          </div>
          
          <div class="form-group">
            <label for="message" class="required">Description</label>
            <textarea id="message" class="form-control" rows="4" placeholder="Décrivez votre problème ou demande en détail..."></textarea>
            <div class="form-note">Veuillez inclure autant de détails que possible pour faciliter le traitement de votre demande.</div>
          </div>
          
          <div class="form-actions">
            <div class="form-required-note">
              <span>*</span> Champs obligatoires
            </div>
            <button class="send-button" (click)="sendContactMessage()">
              <i class="bi bi-send"></i> Soumettre la demande
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
